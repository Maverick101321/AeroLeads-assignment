<% content_for :title, "Add Contacts Â· Autodialer" %>

<div class="dashboard">
  <section class="dashboard-card">
    <header class="card-header">
      <div>
        <h1>Add Contacts</h1>
        <p class="card-subtitle">
          Paste up to 100 numbers, one per line. We accept 10-digit numbers (auto +91) or full +country codes.
        </p>
      </div>
    </header>

    <%= form_with url: contacts_path, method: :post, multipart: true, local: true, class: "stacked-form" do |form| %>
      <div class="form-group">
        <%= form.label :numbers, "Paste Numbers", class: "form-label" %>
        <%= form.text_area :numbers,
          rows: 8,
          placeholder: "Enter phone numbers (one per line)\ne.g. +919876543210\n9876543210",
          class: "form-input textarea" %>
        <p class="form-hint">Accepts 10-digit numbers (auto +91) or full international format.</p>
      </div>

      <div class="form-divider">
        <span>OR</span>
      </div>

      <div class="form-group">
        <%= form.label :file, "Upload CSV/Excel", class: "form-label" %>
        <div class="file-upload-wrapper">
          <%= form.file_field :file, accept: ".csv, .txt", class: "file-input" %>
          <div class="file-upload-visual">
            <span class="file-icon">ðŸ“„</span>
            <span class="file-text">Choose a file or drag it here</span>
          </div>
        </div>
        <p class="form-hint">Supported formats: .csv, .txt (one number per line)</p>
      </div>

      <div class="form-actions">
        <%= form.submit "Import Contacts", class: "btn-primary btn-block" %>
      </div>
    <% end %>
  </section>

  <% if @contacts.any? %>
    <section class="dashboard-card">
      <header class="card-header">
        <div>
          <h2>Recently Added Contacts</h2>
          <p class="card-subtitle">Latest phone numbers waiting to be dialed.</p>
        </div>
      </header>

      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>Phone Number</th>
              <th>Status</th>
              <th>Last Called</th>
            </tr>
          </thead>
          <tbody>
            <% @contacts.order(id: :desc).limit(20).each do |contact| %>
              <% status_value = contact.status.to_s.presence || "pending" %>
              <% status_key = status_value.parameterize %>
              <tr>
                <td><%= contact.phone_number %></td>
                <td><span class="status-pill status-<%= status_key %>"><%= status_value.titleize %></span></td>
                <td><%= contact.last_called_at&.strftime("%b %d, %Y %l:%M %p") || "Not yet" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </section>
  <% end %>
</div>